package org.techtown.moment;import android.content.Context;import android.content.Intent;import android.database.Cursor;import android.os.Bundle;import androidx.fragment.app.Fragment;import androidx.recyclerview.widget.LinearLayoutManager;import androidx.recyclerview.widget.RecyclerView;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.Toast;import java.util.ArrayList;import java.util.Date;public class DiaryDayFragment extends Fragment {    private static final String TAG = "DiaryDayFragment";    DataAdapter adapter;    RecyclerView diaryDayListView;    Context context;    int year,month,day;    @Override    public void onAttach(Context context) {        super.onAttach(context);        this.context = context;    }    @Override    public void onDetach() {        super.onDetach();        if (context != null) {            context = null;        }    }    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        View diaryDay =inflater.inflate(R.layout.fragment_diary_day, container, false);        init((ViewGroup)diaryDay);        return diaryDay;    }    public void init(ViewGroup diaryDayView){        diaryDayListView = diaryDayView.findViewById(R.id.diaryDayListView);        LinearLayoutManager layoutManager = new LinearLayoutManager(getContext());        diaryDayListView.setLayoutManager(layoutManager);        adapter = new DataAdapter();        diaryDayListView.setAdapter(adapter);        Log.d(TAG,TAG+" init");        if(getArguments()!=null){            Bundle bundle=getArguments();            year=bundle.getInt("year");            month=bundle.getInt("month");            day=bundle.getInt("day");            String tText = year+"년 "+month+"월 "+day+"일~~~";            showToast(tText);            Log.d(TAG,tText);            loadDiaryListData(year,month,day);        }        adapter.setOnItemClickListener(new OnItemClickListener() {            @Override            public void onItemClick(View view, int position) {                DiaryData item = adapter.getItem(position);                if (item != null) {                    Log.d(TAG, "아이템 선택됨 : " + item.get_id());                    Intent intent = new Intent(getActivity(), OneDayDiary.class);                    intent.putExtra("ID", item.get_id());                    startActivity(intent);                    onResume();                }            }        });    }    public void loadDiaryListData(int year,int month,int dayOfMonth){        Log.d("DiaryDayOfMonth","loadDiaryData called");        String r_year = String.format("%04d", year);        String r_month = String.format("%02d", month);        String r_dayOfMonth = String.format("%02d", dayOfMonth);        String selectDate = r_year +"-"+ r_month +"-"+ r_dayOfMonth;        Log.d("DiaryDayOfMonth",selectDate);        String sql = "select * from " + DiaryDatabase.TABLE_DIARY + " where CREATE_DATE like ('%"+selectDate+"%') order by CREATE_DATE desc";        int recordCount = -1;        DiaryDatabase database = DiaryDatabase.getInstance(context);        if (database != null) {            Cursor outCursor = database.rawQuery(sql);            recordCount=outCursor.getCount();            AppConstants.println("record count : "+ recordCount+"\n");            ArrayList<DiaryData> items=new ArrayList<DiaryData>();            for(int i=0;i<recordCount;i++) {                outCursor.moveToNext();                String dateStr = outCursor.getString(4);                String createDateStr = null;                if (dateStr != null && dateStr.length() > 10) {                    try {                        Date inDate = AppConstants.dateFormat8.parse(dateStr);                        createDateStr = AppConstants.dateFormat9.format(inDate);                    } catch (Exception e) {                        e.printStackTrace();                    }                } else {                    createDateStr = "";                }                int _id = outCursor.getInt(0);                String address = outCursor.getString(1);                String contents = outCursor.getString(2);                String picture = outCursor.getString(3);                Log.d(TAG, "address : " + address + ", contents : " + contents + ", picture : " + picture + ", createDate : " + createDateStr);                items.add(new DiaryData(_id, address, contents, picture, createDateStr));            }            outCursor.close();            adapter.setItems(items);            adapter.notifyDataSetChanged();        }    }    public void showToast(String message){        Toast.makeText(this.getActivity(),message,Toast.LENGTH_SHORT).show();    }}